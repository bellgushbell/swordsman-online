<?php

require_once __DIR__ . '/../connect_db.php';

$response = array();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // à¸£à¸±à¸šà¸„à¹ˆà¸²à¸ˆà¸²à¸à¸Ÿà¸­à¸£à¹Œà¸¡
    $email = mysqli_real_escape_string($conn, $_POST['email']);

    // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸­à¸µà¹€à¸¡à¸¥à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸‡
    if (!empty($email)) {
        // ðŸ” à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸­à¸µà¹€à¸¡à¸¥à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
        $checkQuery = "SELECT COUNT(*) AS count FROM preregister_email WHERE email = '$email'";
        $checkResult = mysqli_query($conn, $checkQuery);
        $row = mysqli_fetch_assoc($checkResult);

        if ($row['count'] > 0) {
            // âš  à¸–à¹‰à¸²à¸­à¸µà¹€à¸¡à¸¥à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§
            $response['success'] = false;
            $response['message'] = "à¸­à¸µà¹€à¸¡à¸¥à¸™à¸µà¹‰à¸–à¸¹à¸à¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§!";
        } else {
            // âœ… à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µ à¹ƒà¸«à¹‰à¸šà¸±à¸™à¸—à¸¶à¸à¸¥à¸‡à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
            $query = "INSERT INTO preregister_email (email) VALUES ('$email')";
            if (mysqli_query($conn, $query)) {
                $response['success'] = true;
                $response['message'] = "à¸­à¸µà¹€à¸¡à¸¥à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§!";
            } else {
                $response['success'] = false;
                $response['message'] = "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”: " . mysqli_error($conn);
            }
        }
    } else {
        $response['success'] = false;
        $response['message'] = "à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸­à¸µà¹€à¸¡à¸¥!";
    }
}

// à¸›à¸´à¸”à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
mysqli_close($conn);

// à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸›à¹‡à¸™ JSON
echo json_encode($response);
?>
